# User Management System - Source Documentation

This document provides an overview of the source code for the User Management System, a FastAPI-based application. It details the project structure, key components, and the design principles that make it a maintainable and scalable application.

## Project Structure

The project is organized into several key directories and files at the root level, with the main application logic residing within the `src` directory.

```
/
├── alembic.ini             # Configuration for Alembic database migrations.
├── database.db             # SQLite database file.
├── migrations/             # Contains database migration scripts generated by Alembic.
│   ├── versions/           # Individual migration files.
│   └── ...
├── src/                    # Main application source code.
│   ├── __init__.py         # Initializes the `src` directory as a Python package.
│   ├── config.py           # Centralized application configuration.
│   ├── auth/               # Handles authentication and authorization.
│   │   ├── dependencies.py # FastAPI dependencies for auth (e.g., role checks).
│   │   ├── errors.py       # Custom authentication-related exceptions.
│   │   ├── routes.py       # API endpoints for signup, login, etc.
│   │   ├── schemas.py      # Pydantic schemas for auth data.
│   │   ├── service.py      # Business logic for authentication.
│   │   └── utils.py        # Utility functions (e.g., password hashing).
│   ├── database/           # Manages database connectivity.
│   │   ├── main.py         # SQLAlchemy engine setup and session management.
│   │   └── redis.py        # Redis client for blocklisting JWTs.
│   └── users/              # Handles user-related logic and endpoints.
│       ├── errors.py       # Custom user-related exceptions.
│       ├── models.py       # SQLModel table definitions for users.
│       ├── routes.py       # API endpoints for user CRUD operations.
│       ├── schemas.py      # Pydantic schemas for user data.
│       └── services.py     # Business logic for user operations.
└── ...                     # Other project files (e.g., .gitignore, venv).
```

## Modules

### Authentication (`auth`)

-   **`routes.py`**: Defines the API endpoints for user authentication, such as `/signup`, `/login`, `/refresh_token`, and `/logout`.
-   **`service.py`**: Contains the business logic for creating and authenticating users.
-   **`schemas.py`**: Defines the Pydantic models for data validation, such as `UserCreateSchema` and `UserLoginSchema`.
-   **`dependencies.py`**: Implements dependency injection for getting the current user and role-based access control.
-   **`utils.py`**: Provides utility functions for password hashing and JWT creation.

### Database (`database`)

-   **`main.py`**: Sets up the asynchronous database engine (SQLAlchemy) and provides a dependency (`get_session`) for managing database sessions. It also includes logic to initialize the database and create tables.
-   **`redis.py`**: Contains functions for interacting with Redis, used here for a token blocklist to handle logouts.

### Users (`users`)

-   **`routes.py`**: Defines the API endpoints for user management, including creating, retrieving, updating, and deleting users. It features both soft and hard delete functionalities.
-   **`services.py`**: Implements the business logic for user-related operations.
-   **`models.py`**: Defines the `User` and `UserActivityLog` SQLModel tables, representing the database schema.
-   **`schemas.py`**: Contains Pydantic models for user-related API responses, such as a generic paginated list response.

## Maintainability

This project was designed with maintainability in mind, incorporating several best practices:

-   **Modular Design**: The clear separation of concerns into `auth`, `users`, and `database` modules makes the codebase easy to navigate and understand. It allows developers to work on one feature without unintentionally affecting others.

-   **Dependency Injection**: FastAPI's dependency injection is used extensively (e.g., `get_session`, `get_current_user`). This decouples components, making them easier to test in isolation with mock dependencies.

-   **Centralized Configuration**: All settings are managed in `src/config.py` using Pydantic's `BaseSettings`. This allows for easy configuration changes through environment variables without modifying the code.

-   **Clear Schema Definitions**: By using Pydantic schemas (`schemas.py` in each module), the API's data contracts are explicit and self-documenting. This ensures data validation and reduces runtime errors.

-   **Asynchronous Code**: The use of `async` and `await` with an asynchronous database driver (`create_async_engine`) ensures the application is non-blocking and can handle high concurrency, making it scalable.

-   **Role-Based Access Control (RBAC)**: The `RoleChecker` dependency provides a simple yet effective way to secure endpoints based on user roles, making the API's security model easy to manage and extend.

## Running the Application

To run the application, you would typically use an ASGI server like Uvicorn. Assuming the main FastAPI app instance is in a file named `main.py` at the root of the project, you would run:

```bash
# Ensure you have an .env file with the required settings (see config.py)
uvicorn main:app --reload
```
